# Client - Booksquare :fire:

[Next.js](https://nextjs.org/) with modifications.

## Usagez

Recommended node version is defined in `.nvmrc`.

- `yarn install` - Install packages
- `yarn start` - Start development server on port 9000
- `yarn start:staging` - Same as `yarn start` but with staging settings
- `yarn start:production` - Same as `yarn start` but with production settings
- `yarn build` - Build project to the build folder
- `yarn build:staging` - Same as `yarn build` but with staging settings
- `yarn build:production` - Same as `yarn build` but with production settings
- `yarn serve` - Serve the build folder on port 9090
- `yarn serve:staging` - Same as `yarn serve` but with staging settings
- `yarn serve:production` - Same as `yarn serve` but with production settings
- `yarn cypress:open` - Open [Cypress](https://www.cypress.io/) test runner
- `yarn cypress:run` - Run [Cypress](https://www.cypress.io/) tests to completion
- `yarn cypress:run:staging` z- Same as `yarn cypress:run` but with staging record settings
- `yarn cypress:start` - Start development server together with `cypress:open`
- `yarn cypress:start:staging` - Same as `yarn cypress:start` but with staging details
- `yarn cypress:ci` - Continuous integration together with `cypress:run`
- `yarn cypress:ci:staging` - Same as `yarn cypress:ci` but with staging details
- `yarn prettier:report` - Report any [Prettier](https://prettier.io/) issues
- `yarn prettier:fix` - Fix any [Prettier](https://prettier.io/) issues
- `yarn eslint:report` - Report any [ESLint](https://eslint.org/) issues
- `yarn eslint:fix` - Fix any [ESLint](https://eslint.org/) issues
- `yarn stylelint:report` - Report any [Stylelint](https://stylelint.io/) issues
- `yarn stylelint:fix` - Fix any [Stylelint](https://stylelint.io/) issues
- `yarn typescript:report` - Report any TypeScript issues
- `yarn graphql:operations` - Generate a GraphQL operations file, used for generating hooks
- `yarn graphql:codegen` - Generate the base graphql.schema.json, the schema for the rest of GraphQL
- `yarn graphql:codegen:hooks` - Generate the hooks from GraphQL operations file
- `yarn graphql:schema` - Prints the GraphQL schema SDL from the GraphQL schema JSON introspection
- `yarn graphql:generate` - Generate GraphQL types and hooks from endpoint specified in [graphqlrc](https://graphql-code-generator.com/)
- `yarn lang:extract` - [Extract](https://formatjs.io/docs/tooling/cli#extraction) string messages
- `yarn lang:compile` - [Compile](https://formatjs.io/docs/tooling/cli#compilation) extracted file

## Pages

Pages lives within two places, this because we're using separate sibling files for styling, texts etc. and Next.js doesn't like that. Within the pages folder we're collecting data and making the optional data request, then the page itself with styling, texts etc. should be within the routes folder. So the pages component will send its data as props to the routes component.

## Component lifecycle

You should look at a component as its own lifecycle. Everything about it should be wrapped in the same folder, where the folder name is the components name, and then return itself. This is the structure and files that could/should be included:

```
.
├── components
│   └── ...
│       ├── Example
│       │   ├── Example.module.scss   # Styling
│       │   ├── Example.tsx           # Component
│       │   ├── Example.text.ts       # Intl text
│       │   └── index.ts              # Exports component
│       │   ...
│       └── index.ts                  # Exports every component within the folder
└── ...
```

## GraphQL

This project uses autogenerated types and hooks from graphql-codegen and amplify-graphql-docs-generator.
Generated operations (instructions for hook generation) are generated in `src/graphql`. GraphQL introspection-result are generated to `src/graphql/introspection-result.json`.

Types and hooks are found in `src/types/graphql.ts`.

Amplify-graphql-docs-generator requires a max-depth setting so not to generate infinite files, default here is set to 4.
Generations are controlled by `.graphqlrc.yml` for initial generation, it generates `graphql/graphql.schema.json` that can be executed to
generate `graphql.schema.json.graphql`.

Generate everything with `yarn graphql:generate`.

## Language

We're using [react-intl](https://formatjs.io/docs/react-intl/) to internalize texts. These texts should be created as a sibling to the required file, see **Component lifecycle** above for better understanding. Why? Because otherwise the files would be 1000 kilometres long.

The id of every string needs to be unique, so to prevent this problem you should prepend the id with the component name. This solution isn't bullet proof, but it prevents some problems. Make sure to NOT use dynamic variables, because react-intl doesn't support it.

The exported object with texts must we wrapped with `defineMessages`. Lets say we have a component named `<Modo />` and we want to insert a heading, that would result in something like this:

```
import { defineMessages } from 'react-intl';

export const texts = defineMessages({
  heading: {
    id: 'Modo.heading',
    description: 'Lorem ipsum dolor sit amet',
    defaultMessage: 'Consectetur adipiscing elit'
  }
});
```
